### Django & Nextjs 포트폴리오 구축 (11/24)

## 1. 문제 개요
포트폴리오에 프로젝트 상세 이미지를 여러장 표시 기능을 넣는 과정에서 

- Django -> Nextjs 전달구조는 맞는데, 프론트 이미지가 제대로 안보임
- Django admin에서 여러장 이미지를 업로드해 테스트 해봤지만, JSON에서 리스트가 비정상 구조로 옴
    (썸네일만 나온다거나 수정했더니 모든 사진이 표시가 안된다거나 .. 등등)
- SerializerMethoField 사용중 request context 누락 -> NoneType 에러 발생
- 프론트에서 p.images를 읽지못해 이미지 노출이 아예 안됨 (빈화면)
- 썸네일도 안보이는 문제가 잠시 발생 -> media URL 절대경로 문제였..
- 이미지 경로가 /media/images/~~ 가 아닌 /media/img/ .. 등 오타로 인한 렌더 실패

이미지 처리때문에 .. 백엔드왔다 프론트 갔다 ..거의 전체를 갈아엎는 수준의 수정작업이 필요했었다

## 2. 원인분석

# 1) Serializer 의 request context가 전달되지 않음
projectImageSerializer 안에서 

```
request = self.context.get('request')
```
값이 None -> NoneType 에러 발생

원인 : views.py 에서 projectSerializer(...) 호출시 context 전달 안함


# 2) 이미지 URL 필드 이름 사용 불일치
백엔드 : images
프론트 : img/image로 접근
-> 서로 다른 이름 사용으로 매칭 실패, 이미지를 불러오지 못함
(실제 JSON구조와 프론트 코드가 안맞아서 생긴 실패)

# 3) 썸네일 경로 확인 누락
썸네일 미리보기가 나오지 않았던 이유 분석
- 프론트에서 p.thumbnail 사용중
- 백엔드 모델에서는 thumbnail 필드가 upload_to="thumbnails/" 구조
- 프론트는 상대경로 형태로 받아 절대경로로 변환이 필요

http://127.0.0.1:8000${p.thumbnail} 형태로 수정 후 정상동작


# 4) 이미지 키가 배열인지 단일 객체인지 불명확

백엔드에서는 
```
images = ProjectImageSerializer(many=True)
```
형태로 오는데 프론트에서 단일 이미지처럼 다루고있어서 오류 발생


## 3. 해결과정 (타임라인)

# 1) Serializer context 전달

- view 수정 : 
```
serializer = ProjectSerializer(projects, many=True, context={"request":request})
```

- 이미지 URL 생성시 request 사용 가능해짐

- NoneType 에러 해결 ! 


# 2) 이미지 필드 이름을 images로 통일

- 프론트: 
```
project.images.map(...)
```
이 구조를 기준으로 UI 재작성
-> 여러장이미지 정상 출력 (백엔드를 먼저 생각하고 프론트를 나중에 구현했더니 이름을 햇깔렸던것도 한몫했을지도..)


# 3) 썸네일 경로 = 절대경로 처리
- Nextjs : 
```
src={'http://127.0.0.1:8000${p.thumbnail}'}
```

-> 수정 후 썸네일 정상 렌더링! 

# 4) 모달 내부 이미지 갤러리 구성
- 프로젝트 클릭 -> 모달열림 -> images 배열을 슬라이드처럼 출력 CSS조정 후 UI 안정화 완료
    -> 크게보기 애니메이션까지 적용 완료!

## 4. 최종결과! 

- Django -> 이미지 다중 업로드 기능 정상동작!
- Nextjs -> 프론트에서 여러장 이미지 UI 정상 표시
- 썸네일 + 상세이미지 모두 정상 렌더링
- 모달 UI 정리(타이틀 / 이미지 / 기술스텍 / 설명 / 링크 순)
- 프로젝트 정렬도 order_by('-id')로 최신순 정렬

전반적인 포트폴리오 UI의 완성도가 ~~(나름)~~ 확 올라감!

## 5. 이번 이슈로 배운점 
- Srializer context는 request 기반 URL 생성시 필수! 
- 백엔드와 프론트의 데이터 구조는 이름 하나만 달라도 와르르 무너짐..
- 이미지 경로는 절대경로 / 상대경로의 정확한 이해가 중요 !
- 모달 UI작업은 프론트 구조를 확실히 잡은 후 들어가야 안정적이다!
- Django media/static은 반드시 직접 serve해줘야 한다
- 최신순 정렬은 DB에서 처리하는게 가장 안전! (order_by('-id'))

## 6. 다음에 할것!

- 프로젝트 데이터 내용 채우기 (Django Admin에서!)
- 방문자수 (today, total)기록 기능 추가
- 포트폴리오 전체 컬러톤 정리(아직 맘에 안듬)
- 프론트 배포(vercel), 백엔드 배포 (aws lightsail)
- 도메인 연결 (가능하다면)
- 포트폴리오 내의 프로젝트 설명 정리
